# Руководство по Разработке

Это руководство содержит набор рекомендаций и лучших практик для разработки в рамках данного проекта-заготовки. Следование этим принципам поможет поддерживать качество, консистентность и управляемость кодовой базы.

## 1. Стиль Кода и Форматирование

*   **Бэкенд (Python):**
    *   Следуйте стандарту [PEP 8](https://www.python.org/dev/peps/pep-0008/).
    *   Используйте автоматические форматеры кода, такие как `Black`, и линтеры, например, `Flake8` или `Pylint`.
    *   Конфигурации для этих инструментов (например, `pyproject.toml` для Black, `.flake8` для Flake8) должны быть частью репозитория.
    *   Используйте подсказки типов (type hints) везде, где это возможно. Pydantic модели уже требуют их, но также типизируйте параметры функций, возвращаемые значения и переменные.
    *   Пишите осмысленные docstrings для модулей, классов и функций (например, в стиле Google или NumPy).

*   **Фронтенд (TypeScript/Vue):**
    *   Используйте `Prettier` для автоматического форматирования кода.
    *   Используйте `ESLint` с рекомендуемыми конфигурациями для Vue 3 и TypeScript (например, `@vue/eslint-config-typescript/recommended` и `@vue/eslint-config-prettier`).
    *   Конфигурационные файлы (`.eslintrc.js`, `.prettierrc.js`) должны быть в репозитории.
    *   Следуйте принципам чистого кода: давайте понятные имена переменным, функциям и компонентам; разбивайте сложную логику на более мелкие, переиспользуемые части.
    *   Используйте Composition API в Vue для лучшей организации логики компонентов.
    *   Определяйте интерфейсы и типы TypeScript для props, событий, данных store и ответов API.

## 2. Система Контроля Версий (Git)

*   **Ветки:**
    *   `main` (или `master`): Основная ветка, содержащая стабильный, готовый к развертыванию код.
    *   `develop`: Ветка для текущей разработки. Новые фичи сливаются в нее.
    *   **Feature-ветки**: Для каждой новой фичи или значительного изменения создавайте отдельную ветку от `develop` (например, `feature/user-profile`, `fix/login-bug`).
        *   Имя ветки должно быть информативным.
    *   После завершения работы над фичей, создается Pull Request (PR) из feature-ветки в `develop`.
*   **Коммиты:**
    *   Делайте небольшие, атомарные коммиты.
    *   Пишите осмысленные сообщения коммитов. Рекомендуется использовать [Conventional Commits](https://www.conventionalcommits.org/) (например, `feat: add user login endpoint`, `fix: resolve issue with token refresh`, `docs: update authentication guide`).
*   **Pull Requests (PRs) / Merge Requests (MRs):**
    *   Перед слиянием в `develop` (а затем из `develop` в `main`), код должен проходить ревью (code review) другими членами команды.
    *   PR должен содержать описание сделанных изменений.
    *   Убедитесь, что все тесты проходят и линтеры не показывают ошибок перед созданием PR.
*   **Регулярно синхронизируйтесь:** Делайте `git pull` из `develop` в свою feature-ветку, чтобы избежать больших конфликтов слияния.

## 3. Тестирование

*   **Бэкенд:**
    *   **Unit-тесты**: Для тестирования отдельных функций, методов и классов (например, утилит, логики в сервисах Pydantic моделей). Используйте `pytest`.
    *   **Интеграционные тесты**: Для тестирования взаимодействия между компонентами (например, эндпоинты API и их взаимодействие с базой данных или другими сервисами). `pytest` с `HTTPX` клиентом для FastAPI.
    *   Тесты должны находиться в директории `tests/backend/` (разделенные на `unit` и `integration`).
*   **Фронтенд:**
    *   **Unit-тесты**: Для тестирования отдельных компонентов, функций Composition API, методов store Pinia. Используйте `Vitest` (или Jest) и `Vue Testing Library`.
    *   **Компонентные тесты**: Проверка корректной работы компонентов в изоляции или с небольшим количеством дочерних компонентов.
    *   **End-to-End (E2E) тесты**: Для тестирования пользовательских сценариев в браузере. Используйте `Cypress` или `Playwright`.
    *   Тесты должны находиться в директории `tests/frontend/`.
*   **Общее:**
    *   Стремитесь к высокому покрытию кода тестами.
    *   Тесты должны быть частью CI/CD пайплайна.

## 4. Добавление Новой Функциональности

### Бэкенд Микросервис:
1.  **Определите Модели (Pydantic Schemas)**: В `backend/shared/models/` создайте или обновите схемы для данных, с которыми будет работать новая функциональность.
2.  **Настройки (если нужны)**: Добавьте новые переменные конфигурации в `backend/shared/config/settings.py` и в `.env.example`.
3.  **Логика Сервиса**: Если это касается существующего сервиса (`user_service`, `auth_service`), добавьте новые функции/классы для обработки бизнес-логики.
4.  **Эндпоинты API**: В соответствующем сервисе, в директории `api/v1/endpoints/`, создайте новый файл для роутера или добавьте эндпоинты в существующий.
5.  **Задачи Celery (если нужны)**: Если часть функциональности должна выполняться асинхронно, определите задачу в `celery_worker/tasks.py` и функцию для ее вызова в `backend/shared/utils/celery_client.py`.
6.  **Тесты**: Напишите unit и интеграционные тесты.
7.  **Документация API**: FastAPI автоматически генерирует OpenAPI документацию. Убедитесь, что ваши Pydantic модели и эндпоинты имеют хорошие описания.
8.  **Обновите документацию проекта**: Если новая фича значительная, обновите соответствующие `.md` файлы в `docs/`.

### Фронтенд:
1.  **Определите Типы (TypeScript)**: Создайте интерфейсы для данных, с которыми будет работать новая фича (часто они будут соответствовать Pydantic схемам бэкенда).
2.  **Сервис API**: В `src/services/` создайте или обновите сервис для взаимодействия с новыми эндпоинтами бэкенда.
3.  **Store (Pinia)**: Если данные новой фичи должны быть глобальными или совместно использоваться несколькими компонентами, создайте или обновите модуль Pinia в `src/store/`.
4.  **Компоненты**: Создайте новые Vue компоненты в `src/components/` (для UI-элементов) и `src/views/` (для страниц).
5.  **Маршрутизация**: Если создается новая страница, добавьте маршрут в `src/router/index.ts`.
6.  **Используйте Composables**: Для переиспользуемой логики компонентов создавайте composable-функции в `src/composables/`.
7.  **Тесты**: Напишите unit/компонентные тесты для новой логики и компонентов.
8.  **Обновите документацию проекта**: Если применимо.

## 5. Переменные Окружения

*   Все конфигурационные параметры, которые могут меняться между окружениями (dev, staging, prod) или являются чувствительными (секреты, ключи API), должны управляться через переменные окружения.
*   Добавляйте новые переменные в `.env.example` с описанием и значением по умолчанию (если применимо).
*   На бэкенде используйте `pydantic-settings` (`backend/shared/config/settings.py`) для загрузки и валидации переменных окружения.

## 6. Логирование

*   **Бэкенд**: Используйте стандартный модуль `logging` Python. Настройте логгер (например, с помощью `setup_logger` из `backend/shared/utils/helpers.py`) для вывода информативных сообщений.
    *   Логируйте важные события, ошибки, входящие запросы (опционально, с учетом чувствительности данных).
    *   В продакшене логи должны собираться и анализироваться централизованно.
*   **Фронтенд**: Используйте `console.log`, `console.warn`, `console.error` осмысленно во время разработки. Для продакшена рассмотрите интеграцию с сервисами мониторинга ошибок фронтенда (Sentry, Bugsnag).

## 7. Безопасность

*   **Никогда не храните секреты в коде.** Используйте переменные окружения.
*   Валидируйте все входящие данные (Pydantic на бэкенде, проверки на фронтенде).
*   Защищайтесь от распространенных веб-уязвимостей (XSS, CSRF, SQL Injection - хотя MongoDB менее подвержена классическим SQLi).
*   Следите за обновлениями зависимостей, чтобы исправлять известные уязвимости.
*   Регулярно проводите ревью кода с фокусом на безопасность.

Следуя этим рекомендациям, вы сможете поддерживать высокое качество проекта и упростить его дальнейшее развитие и поддержку. 